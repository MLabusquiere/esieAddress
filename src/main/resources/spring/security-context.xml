<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:security="http://www.springframework.org/schema/security"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
       http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd">

    <security:global-method-security pre-post-annotations="enabled" />
    <!-- This is where we configure Spring-Security  -->
    <!--<security:authentication-manager alias="openIDAuthenticationManager" />
    <security:http pattern="/login.html" security="none"/>
    <security:http pattern="/css/**" security="none"/>
    <security:http pattern="/images/**" security="none"/>
    <security:http pattern="/font/**" security="none"/>
    <security:http pattern="/font/**" security="none"/>
    -->
    <security:http pattern="index.html/**" security="none"/>

    <!--Special route for Training web services-->
    <!--<security:http pattern="/rest/**" security="none"/>-->
    <security:http auto-config="true" use-expressions="true" entry-point-ref="authenticationEntryPoint" >
        <security:anonymous enabled="false" />

        <security:intercept-url pattern="/**" access="isAuthenticated()" />
        <security:logout
                invalidate-session="true"
                logout-success-url="/login.html"
                logout-url="/logout"/>
        <!-- Adding the openid-login tag activates Spring Security's support for OpenID  -->
        <security:openid-login
                authentication-failure-handler-ref="ajaxAuthenticationFailureHandler"
                authentication-success-handler-ref="ajaxAuthenticationSuccessHandler"

                user-service-ref="securityService"
                always-use-default-target="true"
                default-target-url="/">
            <security:attribute-exchange identifier-match="https://www.google.com/.*">
                <security:openid-attribute name="email" type="http://schema.openid.net/contact/email" required="true" />
            </security:attribute-exchange>
        </security:openid-login>
        <!--<security:remember-me use-secure-cookie="true" token-repository-ref="tokenRepo"/>-->

    </security:http>
    <bean id="tokenRepo" class="org.springframework.security.web.authentication.rememberme.InMemoryTokenRepositoryImpl" />

    <security:authentication-manager alias="authenticationManager">
        <security:authentication-provider user-service-ref="securityService"/>
    </security:authentication-manager>

    <!-- Declare an authentication-manager to use a custom userDetailsService -->
    <bean id="securityService" class="fr.esiea.esieaddress.service.security.SecurityService" />

    <bean id="authenticationEntryPoint"
          class="fr.esiea.esieaddress.controllers.security.Http401DeniedEntryPoint"/>
    <bean id="ajaxAuthenticationSuccessHandler"
                class="fr.esiea.esieaddress.controllers.security.AjaxAuthenticationSuccessHandler"/>
    <bean id="ajaxAuthenticationFailureHandler"
                class="fr.esiea.esieaddress.controllers.security.AjaxAuthenticationFailureHandler"/>
    <bean id="ajaxLogoutSuccessHandler"
                class="fr.esiea.esieaddress.controllers.security.AjaxLogoutSuccessHandler"/>
</beans>